;(function(){"use strict";var app=new Reef(document.querySelector("#app"),{data:{},template:template});var storageID="todos";function getParams(url){var params={};var parser=document.createElement("a");parser.href=url?url:window.location.href;var query=parser.search.substring(1);var vars=query.split("&");if(vars.length<1||vars[0].length<1)return params;for(var i=0;i<vars.length;i++){var pair=vars[i].split("=");params[decodeURIComponent(pair[0])]=decodeURIComponent(pair[1])}return params}function template(props){if(props.listID!==null&&props.listID!==undefined){return getItemsTemplate(props)}return getListsTemplate(props)}function getItemsTemplate(props){var index=getParams().list;var list=props.lists[index];var form="<a href='index.html'>&larr; Back to lists</a>"+"<h2>"+list.name+"</h2>"+"<form id='add-items'>"+"<label for='new-item'>What do you want to do?</label>"+"<div class='flex'>"+"<input id='new-item' type='text' autofocus"+(props.edit?" value='"+list.items[props.edit].name+"'":"")+">"+"<button type='submit'>"+(props.edit?"Save":"Add")+" Item</button>"+"</div>"+"</form>";if(list.items.length<1){return form+"<p>You haven't added any list items. Add some using the form above.</p>"}return form+"<ul>"+list.items.map((function(item,index){var inputID="item-"+index;return"<li>"+"<input id='"+inputID+"' type='checkbox'>"+"<label for='"+inputID+"'>"+item.name+"</label>"+"<button class='pa0 bn bg-transparent' type='button' aria-label='Edit' data-edit='"+index+"'>✏️</button>"+"<button class='pa0 bn bg-transparent' type='button' aria-label='Delete' data-delete='"+index+"'>🗑</button>"+"</li>"})).join("")+"</ul>"}function getListsTemplate(props){var form="<form id='add-lists'>"+"<label for='new-list'>Create a new to-do list</label>"+"<div class='flex'>"+"<input id='new-list' type='text' autofocus"+(props.edit?" value='"+props.lists[props.edit].name+"'":"")+">"+"<button type='submit'>"+(props.edit?"Save":"Create")+" List</button>"+"</div>"+"</form>";if(props.lists.length<1){return form+"<p>You haven't created any lists. Add some using the form above.</p>"}return form+"<ul>"+props.lists.map((function(list,index){return"<li>"+"<a href='?list="+index+"'>"+list.name+"</a>"+"<button class='pa0 bn bg-transparent' type='button' aria-label='Edit' data-edit='"+index+"'>✏️</button>"+"<button class='pa0 bn bg-transparent' type='button' aria-label='Delete' data-delete='"+index+"'>🗑</button>"+"</li>"})).join("")+"</ul>"}function addItemOrList(event){event.preventDefault();var input=event.target.querySelector("input");if(!input.value.trim())return;var data=app.getData();if(event.target.id==="add-items"){if(data.edit){data.lists[data.listID].items[data.edit].name=input.value}else{data.lists[data.listID].items.push({name:input.value,done:false})}}else if(event.target.id==="add-lists"){if(data.edit){data.lists[data.edit].name=input.value}else{data.lists.push({name:input.value,items:[]})}}app.setData({lists:data.lists,edit:null});input.value="";input.focus()}function toggleItem(event){if(event.target.type!=="checkbox")return;var data=app.getData();var index=event.target.id.slice(-1);data.lists[data.listID].items[index].done=event.target.checked;app.setData({lists:data.lists})}function editItemOrList(event){var index=event.target.getAttribute("data-edit");if(!index)return;app.setData({edit:index})}function deleteItemOrList(event){var index=event.target.getAttribute("data-delete");if(!index)return;var data=app.getData();if(!confirm("Are you sure you want to delete this"+(data.listID?"list":"item")+"? This cannot be reversed."))return;if(data.listID){data.lists[data.listID].items.splice(index,1)}else{data.lists.splice(index,1)}app.setData({lists:data.lists,edit:null})}function handleClick(event){editItemOrList(event);deleteItemOrList(event)}function handleRender(){localStorage.setItem(storageID,JSON.stringify(app.getData()));var editField=document.querySelector("#new-item, #new-list");if(editField)editField.focus()}function loadLists(){var saved=localStorage.getItem(storageID);var data=saved?JSON.parse(saved):{lists:[]};data.edit=null;var list=getParams().list;data.listID=list;app.setData(data)}loadLists();app.elem.addEventListener("submit",addItemOrList);app.elem.addEventListener("change",toggleItem);app.elem.addEventListener("click",handleClick);app.elem.addEventListener("render",handleRender)})();